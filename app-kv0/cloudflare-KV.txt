Cloudflare KV ã‚’ä½¿ã£ãŸ To-Do List ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹å ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

### **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**
- **ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢**: Cloudflare KVï¼ˆã‚­ãƒ¼ãƒ»ãƒãƒªãƒ¥ãƒ¼ã‚¹ãƒˆã‚¢ï¼‰
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: htmx + HTMLï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆï¼‰
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Cloudflare Workersï¼ˆAPI ã‚µãƒ¼ãƒãƒ¼ï¼‰
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: GitHub Pagesï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰ã€Cloudflare Workersï¼ˆAPIï¼‰

### **æ©Ÿèƒ½**
1. **ã‚¿ã‚¹ã‚¯ã®è¿½åŠ **
2. **ã‚¿ã‚¹ã‚¯ã®å–å¾—**
3. **ã‚¿ã‚¹ã‚¯ã®å‰Šé™¤**
4. **ã‚¿ã‚¹ã‚¯ã®å®Œäº†ãƒãƒ¼ã‚¯**

### **å¤§ã¾ã‹ãªå®Ÿè£…æ–¹é‡**
1. **Cloudflare Workers** ã§ API ã‚’ä½œæˆï¼ˆKV ã‚’æ“ä½œã™ã‚‹ï¼‰
2. **htmx** ã‚’ä½¿ã£ã¦ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’æ§‹ç¯‰
3. **GitHub Pages** ã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€Cloudflare Workers ã® API ã¨é€£æº



cd ~
(npm install -g wrangler)
(npm update -g wrangler)
wrangler --version
wrangler login

mkdir kv-app0
wrangler init kv-app0

cd kv-app0
code .



Cloudflare Dashboard â†’ KV
æ–°ã—ã„ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½œæˆï¼ˆä¾‹: `todo`ï¼‰
kv idç™ºè¡Œ ---  

`wrangler.jsonc` ã« KV ã®è¨­å®šã‚’è¿½åŠ :

{
	"$schema": "node_modules/wrangler/config-schema.json",
	"name": "kv-app0",
	"main": "src/index.js",
	"compatibility_date": "2025-03-13",
	"observability": {
		"enabled": true
	},
	"kv_namespaces": [
		{
			"binding": "todo",
			"id": "---"
		}
	]
}


wrangler kv namespace list




### **Cloudflare Workers ã®ã‚³ãƒ¼ãƒ‰**

index.js

export default {
  async fetch(req, env) {
    const url = new URL(req.url);
    if (url.pathname === "/todos") {
      if (req.method === "GET") return getTodos(env);
      if (req.method === "POST") return addTodo(req, env);
    }
    if (url.pathname.startsWith("/todos/")) {
      const id = url.pathname.split("/").pop();
      if (req.method === "DELETE") return deleteTodo(id, env);
      if (req.method === "PUT") return toggleTodo(id, req, env);
    }
    return new Response("Not Found", { status: 404 });
  },
};

// ğŸ“Œ ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’å–å¾— (GET /todos)
async function getTodos(env) {
  const keys = await env.todo.list();
  const todos = await Promise.all(keys.keys.map(k => env.todo.get(k.name, "json")));
  return new Response(JSON.stringify(todos), { headers: { "Content-Type": "application/json" } });
}

// ğŸ“Œ æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ  (POST /todos)
async function addTodo(req, env) {
  const { title } = await req.json();
  if (!title) return new Response("Title is required", { status: 400 });

  const id = crypto.randomUUID();
  const todo = { id, title, done: false, createdAt: new Date().toISOString() };
  await env.todo.put(id, JSON.stringify(todo));

  return new Response(JSON.stringify(todo), { headers: { "Content-Type": "application/json" } });
}

// ğŸ“Œ ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ (DELETE /todos/{id})
async function deleteTodo(id, env) {
  const existing = await env.todo.get(id);
  if (!existing) return new Response("Not Found", { status: 404 });

  await env.todo.delete(id);
  return new Response("Deleted", { status: 200 });
}

// ğŸ“Œ ã‚¿ã‚¹ã‚¯ã®å®Œäº†/æœªå®Œäº†ã‚’åˆ‡ã‚Šæ›¿ãˆ (PUT /todos/{id})
async function toggleTodo(id, req, env) {
  const existing = await env.todo.get(id, "json");
  if (!existing) return new Response("Not Found", { status: 404 });

  const updatedTodo = { ...existing, done: !existing.done };
  await env.todo.put(id, JSON.stringify(updatedTodo));

  return new Response(JSON.stringify(updatedTodo), { headers: { "Content-Type": "application/json" } });
}


ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€Cloudflare KV ã‚’åˆ©ç”¨ã—ãŸ **ã‚·ãƒ³ãƒ—ãƒ«ãª To-Do ãƒªã‚¹ãƒˆ API** ã‚’æä¾›ã—ã¾ã™ã€‚  
ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã”ã¨ã« **GETï¼ˆå–å¾—ï¼‰ãƒ»POSTï¼ˆè¿½åŠ ï¼‰ãƒ»DELETEï¼ˆå‰Šé™¤ï¼‰ãƒ»PUTï¼ˆæ›´æ–°ï¼‰** ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

---

# **ğŸ“Œ ã‚³ãƒ¼ãƒ‰ã®æ¦‚è¦**
### **1. ãƒ«ãƒ¼ãƒˆã®å‡¦ç†**
```javascript
export default {
  async fetch(req, env) {
    const url = new URL(req.url);

    if (url.pathname === "/todos") {
      if (req.method === "GET") return getTodos(env);
      if (req.method === "POST") return addTodo(req, env);
    }

    if (url.pathname.startsWith("/todos/")) {
      const id = url.pathname.split("/").pop();
      if (req.method === "DELETE") return deleteTodo(id, env);
      if (req.method === "PUT") return toggleTodo(id, req, env);
    }

    return new Response("Not Found", { status: 404 });
  },
};
```
ğŸ”¹ **`fetch` ãƒ¡ã‚½ãƒƒãƒ‰** ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã® URL ã¨ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ¤å®šã—ã¦é©åˆ‡ãªé–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚  
ğŸ”¹ `env.todo` ã¯ Cloudflare KV ã®åå‰ç©ºé–“ã§ã™ã€‚

| **HTTP ãƒ¡ã‚½ãƒƒãƒ‰** | **ãƒ‘ã‚¹**          | **å‡¦ç†** |
|------------------|------------------|-------------------------|
| `GET`           | `/todos`          | ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’å–å¾— |
| `POST`          | `/todos`          | æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ  |
| `DELETE`        | `/todos/{id}`     | ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ |
| `PUT`           | `/todos/{id}`     | ã‚¿ã‚¹ã‚¯ã®å®Œäº†çŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆ |

---

# **ğŸ“Œ å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‡¦ç†**
## **2. ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’å–å¾— (`GET /todos`)**
```javascript
async function getTodos(env) {
  const keys = await env.todo.list();
  const todos = await Promise.all(keys.keys.map(k => env.todo.get(k.name, "json")));
  return new Response(JSON.stringify(todos), { headers: { "Content-Type": "application/json" } });
}
```
ğŸ”¹ **`env.todo.list()`** ã§ KV ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ã‚­ãƒ¼ï¼ˆIDï¼‰ã‚’å–å¾—  
ğŸ”¹ **`env.todo.get(k.name, "json")`** ã§ ID ã«ç´ã¥ãã‚¿ã‚¹ã‚¯ã‚’å–å¾—  
ğŸ”¹ **`Promise.all()`** ã§ä¸¦åˆ—å‡¦ç†ã—ã€ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’ JSON ã¨ã—ã¦è¿”ã™

ğŸ“Œ **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä¾‹**
```json
[
  { "id": "123", "title": "è²·ã„ç‰©ã«è¡Œã", "done": false },
  { "id": "456", "title": "å‹‰å¼·ã™ã‚‹", "done": true }
]
```

---

## **3. æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ  (`POST /todos`)**
```javascript
async function addTodo(req, env) {
  const { title } = await req.json();
  if (!title) return new Response("Title is required", { status: 400 });

  const id = crypto.randomUUID();
  const todo = { id, title, done: false, createdAt: new Date().toISOString() };
  await env.todo.put(id, JSON.stringify(todo));

  return new Response(JSON.stringify(todo), { headers: { "Content-Type": "application/json" } });
}
```
ğŸ”¹ `title` ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‹ã‚‰å–å¾—ï¼ˆå¿…é ˆãƒã‚§ãƒƒã‚¯ã‚ã‚Šï¼‰  
ğŸ”¹ **UUIDï¼ˆ`crypto.randomUUID()`ï¼‰ã§ä¸€æ„ã® ID ã‚’ç”Ÿæˆ**  
ğŸ”¹ **ä½œæˆæ—¥æ™‚ (`createdAt`) ã‚’ä¿å­˜**  
ğŸ”¹ KV ã« **`id` ã‚’ã‚­ãƒ¼ã¨ã—ã¦ JSON ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜**  

ğŸ“Œ **ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```json
{ "title": "èª­æ›¸ã™ã‚‹" }
```
ğŸ“Œ **ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "id": "789",
  "title": "èª­æ›¸ã™ã‚‹",
  "done": false,
  "createdAt": "2025-03-18T12:00:00.000Z"
}
```

---

## **4. ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ (`DELETE /todos/{id}`)**
```javascript
async function deleteTodo(id, env) {
  const existing = await env.todo.get(id);
  if (!existing) return new Response("Not Found", { status: 404 });

  await env.todo.delete(id);
  return new Response("Deleted", { status: 200 });
}
```
ğŸ”¹ **`env.todo.get(id)` ã§ã‚¿ã‚¹ã‚¯ãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯**  
ğŸ”¹ å­˜åœ¨ã—ãªã„å ´åˆã¯ **404 Not Found** ã‚’è¿”ã™  
ğŸ”¹ **`env.todo.delete(id)` ã§å‰Šé™¤**  

ğŸ“Œ **ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```http
DELETE /todos/789
```
ğŸ“Œ **ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```
Deleted
```

---

## **5. ã‚¿ã‚¹ã‚¯ã®å®Œäº†/æœªå®Œäº†ã‚’åˆ‡ã‚Šæ›¿ãˆ (`PUT /todos/{id}`)**
```javascript
async function toggleTodo(id, req, env) {
  const existing = await env.todo.get(id, "json");
  if (!existing) return new Response("Not Found", { status: 404 });

  const updatedTodo = { ...existing, done: !existing.done };
  await env.todo.put(id, JSON.stringify(updatedTodo));

  return new Response(JSON.stringify(updatedTodo), { headers: { "Content-Type": "application/json" } });
}
```
ğŸ”¹ **ã‚¿ã‚¹ã‚¯ãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯**  
ğŸ”¹ `done` ã‚’ **`true â‡„ false` ã«ãƒˆã‚°ãƒ«ï¼ˆåˆ‡ã‚Šæ›¿ãˆï¼‰**  
ğŸ”¹ æ›´æ–°ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ KV ã«ä¿å­˜ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ã™  

ğŸ“Œ **ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```http
PUT /todos/789
```
ğŸ“Œ **å¤‰æ›´å‰**
```json
{ "id": "789", "title": "èª­æ›¸ã™ã‚‹", "done": false }
```
ğŸ“Œ **å¤‰æ›´å¾Œ**
```json
{ "id": "789", "title": "èª­æ›¸ã™ã‚‹", "done": true }
```

---



API ã®ãƒ†ã‚¹ãƒˆ

## **1. ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•**
ã¾ãšã€Cloudflare Workers ã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚

```sh
npx wrangler dev
```

ã“ã‚Œã§ã€`http://localhost:8787` ã§ API ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

---

## **2. API ã®å‹•ä½œç¢ºèª**

open new terminal

### **ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’å–å¾—**
```sh
curl -X GET http://localhost:8787/todos
```
**æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
[]
```

---

### **æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ **
```sh
curl -X POST http://localhost:8787/todos \
     -H "Content-Type: application/json" \
     -d '{"title": "Buy groceries"}'
```
**æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "id": "1234-5678-9012",
  "title": "Buy groceries",
  "done": false,
  "createdAt": "2025-03-18T12:34:56.789Z"
}
```
**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® `id` ã¯ UUID ã§ç•°ãªã‚‹**

---

### **ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤**
ID ã‚’ç¢ºèªã—ã€å‰Šé™¤ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```sh
curl -X DELETE http://localhost:8787/todos/1234-5678-9012
```
**æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```
Deleted
```

---

### **ã‚¿ã‚¹ã‚¯ã®å®Œäº†/æœªå®Œäº†ã‚’åˆ‡ã‚Šæ›¿ãˆ**
```sh
curl -X PUT http://localhost:8787/todos/1234-5678-9012
```
**æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "id": "1234-5678-9012",
  "title": "Buy groceries",
  "done": true,
  "createdAt": "2025-03-18T12:34:56.789Z"
}
```

---

### **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ç¢ºèª**
#### **ã‚¿ã‚¤ãƒˆãƒ«ãŒç©ºã®ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ **
```sh
curl -X POST http://localhost:8787/todos \
     -H "Content-Type: application/json" \
     -d '{}'
```
**æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```
Title is required
```
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰:** `400`

#### **å­˜åœ¨ã—ãªã„ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤**
```sh
curl -X DELETE http://localhost:8787/todos/nonexistent-id
```
**æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```
Not Found
```
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰:** `404`

---



cloudflare walkersã¸ãƒ‡ãƒ—ãƒ­ã‚¤

wrangler deploy

ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã® **æœ¬ç•ª URL** (`https://your-worker-url`) ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```sh
curl -X GET https://your-worker-url/todos
```

---



CORS (Cross-Origin Resource Sharing) ã®ã‚¨ãƒ©ãƒ¼ã¯ã€ã‚µãƒ¼ãƒãƒ¼å´ã§é©åˆ‡ãª `Access-Control-Allow-Origin` ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§è§£æ±ºã§ãã¾ã™ã€‚

---

## **ğŸ”§ è§£æ±ºç­–**
ã‚µãƒ¼ãƒãƒ¼å´ (`index.js`) ã« CORS ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

### **1. å…±é€šã® CORS ãƒ˜ãƒƒãƒ€ãƒ¼é–¢æ•°ã‚’ä½œæˆ**
```javascript
function corsHeaders() {
  return {
    "Access-Control-Allow-Origin": "*", // ã™ã¹ã¦ã®ã‚ªãƒªã‚¸ãƒ³ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯
    "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS", // è¨±å¯ã™ã‚‹ HTTP ãƒ¡ã‚½ãƒƒãƒ‰
    "Access-Control-Allow-Headers": "Content-Type", // è¨±å¯ã™ã‚‹ãƒ˜ãƒƒãƒ€ãƒ¼
  };
}
```

---

### **2. `fetch` å†…ã§ CORS ã«å¯¾å¿œ**
```javascript
export default {
  async fetch(req, env) {
    const url = new URL(req.url);

    // CORS ãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ (OPTIONS) ã«å¯¾å¿œ
    if (req.method === "OPTIONS") {
      return new Response(null, { headers: corsHeaders() });
    }

    if (url.pathname === "/todos") {
      if (req.method === "GET") return getTodos(env);
      if (req.method === "POST") return addTodo(req, env);
    }

    if (url.pathname.startsWith("/todos/")) {
      const id = url.pathname.split("/").pop();
      if (req.method === "DELETE") return deleteTodo(id, env);
      if (req.method === "PUT") return toggleTodo(id, req, env);
    }

    return new Response("Not Found", { status: 404, headers: corsHeaders() });
  },
};
```

---

### **3. API ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã« CORS ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ **
å„ API é–¢æ•°ã® `Response` ã« `headers: corsHeaders()` ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```javascript
async function getTodos(env) {
  const keys = await env.todo.list();
  const todos = await Promise.all(keys.keys.map(k => env.todo.get(k.name, "json")));
  return new Response(JSON.stringify(todos), { headers: { ...corsHeaders(), "Content-Type": "application/json" } });
}

async function addTodo(req, env) {
  const { title } = await req.json();
  if (!title) return new Response("Title is required", { status: 400, headers: corsHeaders() });

  const id = crypto.randomUUID();
  const todo = { id, title, done: false, createdAt: new Date().toISOString() };
  await env.todo.put(id, JSON.stringify(todo));

  return new Response(JSON.stringify(todo), { headers: { ...corsHeaders(), "Content-Type": "application/json" } });
}

async function deleteTodo(id, env) {
  const existing = await env.todo.get(id);
  if (!existing) return new Response("Not Found", { status: 404, headers: corsHeaders() });

  await env.todo.delete(id);
  return new Response("Deleted", { status: 200, headers: corsHeaders() });
}

async function toggleTodo(id, req, env) {
  const existing = await env.todo.get(id, "json");
  if (!existing) return new Response("Not Found", { status: 404, headers: corsHeaders() });

  const updatedTodo = { ...existing, done: !existing.done };
  await env.todo.put(id, JSON.stringify(updatedTodo));

  return new Response(JSON.stringify(updatedTodo), { headers: { ...corsHeaders(), "Content-Type": "application/json" } });
}
```

---



ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

index.html

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>To-Do List</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				max-width: 400px;
				margin: 20px auto;
			}
			ul {
				list-style: none;
				padding: 0;
			}
			li {
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding: 8px;
				border-bottom: 1px solid #ddd;
			}
			button {
				margin-left: 10px;
				cursor: pointer;
			}
		</style>
	</head>
	<body>
		<h2>To-Do List</h2>

		<!-- Task input form -->
		<form id="todo-form">
			<input type="text" id="todo-title" name="title" placeholder="New task" required />
			<button type="submit">Add</button>
		</form>

		<!-- Task list -->
		<ul id="todo-list"></ul>

		<script>
			const url = 'https://kv-app0.muchagorou112.workers.dev';
			const todoForm = document.getElementById('todo-form');
			const todoList = document.getElementById('todo-list');

			// Load tasks when the page loads
			async function loadTodos() {
				const response = await fetch(`${url}/todos`);
				const todos = await response.json();
				renderTodos(todos);
			}

			// Render the task list
			function renderTodos(todos) {
				console.log('Rendering todos:', todos); // Debug log
				todoList.innerHTML = ''; // Clear the list
				todos.forEach((todo) => {
					const li = document.createElement('li');
					li.dataset.id = todo.id;
					li.innerHTML = `
                    <span>${todo.done ? 'âœ…' : 'â¬œ'} ${todo.title}</span>
                    <button onclick="toggleTodoStatus('${todo.id}')">Toggle</button>
                    <button onclick="deleteTodo('${todo.id}')">Delete</button>
                	`;
					todoList.appendChild(li);
				});
			}

			// Add a new task
			todoForm.addEventListener('submit', async (event) => {
				event.preventDefault();
				const title = document.getElementById('todo-title').value;
				const response = await fetch(`${url}/todos`, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ title }),
				});
				// const newTodo = await response.json();
				loadTodos(); // Reload task list
				todoForm.reset();
			});

			// Toggle task completion status
			async function toggleTodoStatus(id) {
				const response = await fetch(`${url}/todos/${id}`, {
					method: 'PUT',
				});
				const updatedTodo = await response.json();
				loadTodos(); // Reload task list
			}

			// Delete a task
			async function deleteTodo(id) {
				const response = await fetch(`${url}/todos/${id}`, {
					method: 'DELETE',
				});
				loadTodos(); // Reload task list
			}

			// Load tasks on page load
			loadTodos();
		</script>
	</body>
</html>


GitHub Pages ã« HTML ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰



htmx ã‚’ä½¿ç”¨ã—ãŸã‚·ãƒ³ãƒ—ãƒ«ãªãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã—ãŸã€‚  
Cloudflare KV ã‚’åˆ©ç”¨ã—ãŸ To-Do ãƒªã‚¹ãƒˆã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã™ã€‚  

- **æ©Ÿèƒ½**  
  - ã‚¿ã‚¹ã‚¯ã®å–å¾— (`GET /todos`)  
  - ã‚¿ã‚¹ã‚¯ã®è¿½åŠ  (`POST /todos`)  
  - ã‚¿ã‚¹ã‚¯ã®å‰Šé™¤ (`DELETE /todos/{id}`)  
  - ã‚¿ã‚¹ã‚¯ã®å®Œäº†/æœªå®Œäº†ã‚’åˆ‡ã‚Šæ›¿ãˆ (`PUT /todos/{id}`)  

---

### **`index.html`**
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List</title>
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 400px; margin: 20px auto; }
        ul { list-style: none; padding: 0; }
        li { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #ddd; }
        button { margin-left: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h2>To-Do List</h2>

    <!-- ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form hx-post="/todos" hx-trigger="submit" hx-target="#todo-list" hx-swap="outerHTML">
        <input type="text" name="title" placeholder="New task" required>
        <button type="submit">Add</button>
    </form>

    <!-- ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ -->
    <ul id="todo-list" hx-get="/todos" hx-trigger="load" hx-swap="outerHTML"></ul>

</body>
</html>
```

---

### **ã‚µãƒ¼ãƒãƒ¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‡¦ç†ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**
Cloudflare Workers ã® `fetch` ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰è¿”ã™ HTML ã¯æ¬¡ã®ã‚ˆã†ã«æ§‹æˆã—ã¾ã™ã€‚

#### **`getTodos` ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```javascript
async function getTodos(env) {
  const keys = await env.todo.list();
  const todos = await Promise.all(keys.keys.map(k => env.todo.get(k.name, "json")));

  // HTML ã‚’è¿”ã™
  const html = `<ul id="todo-list">
    ${todos.map(todo => `
      <li>
        <span>${todo.done ? "âœ…" : "â¬œ"} ${todo.title}</span>
        <button hx-put="/todos/${todo.id}" hx-trigger="click" hx-target="#todo-list" hx-swap="outerHTML">
          Toggle
        </button>
        <button hx-delete="/todos/${todo.id}" hx-trigger="click" hx-target="#todo-list" hx-swap="outerHTML">
          Delete
        </button>
      </li>
    `).join("")}
  </ul>`;

  return new Response(html, { headers: { "Content-Type": "text/html" } });
}
```

---

### **ãƒã‚¤ãƒ³ãƒˆ**
- **htmx ã‚’æ´»ç”¨**  
  - `hx-get="/todos" hx-trigger="load"` ã§ã€ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã‚’å–å¾—  
  - `hx-post="/todos"` ã§ã€æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ å¾Œã€è‡ªå‹•ã§ãƒªã‚¹ãƒˆã‚’æ›´æ–°  
  - `hx-delete="/todos/{id}"` ã§ã€ã‚¿ã‚¹ã‚¯å‰Šé™¤æ™‚ã«ãƒªã‚¹ãƒˆã‚’æ›´æ–°  
  - `hx-put="/todos/{id}"` ã§ã€å®Œäº†/æœªå®Œäº†ã‚’åˆ‡ã‚Šæ›¿ãˆ  

- **ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ HTML ã‚’è¿”ã™**  
  - `getTodos` ã¯ HTML ã®ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆã—ã€ç›´æ¥è¿”ã™  
  - JavaScript ã‚’æ›¸ã‹ãšã«ã€htmx ã§å‹•çš„ã«æ›´æ–°  










